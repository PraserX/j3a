<!DOCTYPE html>
<html lang="en-us">

	<head>
		<meta charset="utf-8">
		<meta name="generator" content="Hugo 0.20.2" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="./css/materialize.min.css">
		<link rel="stylesheet" href="./css/custom.css">
		
		<title>Login - J3A</title>
	</head>

	<body>
		<script type="text/javascript" src="./js/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="./js/materialize.min.js"></script>
		<script type="text/javascript" src="./js/j3a.min.js"></script>
		
		<header class="free">
		</header>
		
		<main>
			<div class="container">
				<div class="row row-no-margin-padding">
					<div class="col s12 xl10 offset-xl1">
						<div class="menu hide-on-small-only">
							<ul class="links left">
								<li><a href="./index.html">Main</a></li>
								<li><a href="./about.html">About</a></li>
								<li><a id="link-login" href="./login.html">Login</a></li>
								<li><a id="link-logout" style="display: none" href="#">Logout</a></li>
							</ul>
							<ul class="brands right">
								<li><a href="https://github.com/PraserX/j3a" target="_blank"><i class="fa fa-github"></i></a></li>
							</ul>
							<div style="clear: both;"></div>
						</div>
						<div class="menu hide-on-med-and-up">
							<div class="small">
								<ul class="links">
									<li><a href="./index.html">Main</a></li>
									<li><a href="./about.html">About</a></li>
									<li><a id="link-login" href="./login.html">Login</a></li>
									<li><a id="link-logout" style="display: none" href="#">Logout</a></li>
								</ul>
								<ul class="brands">
									<li><a href="https://github.com/PraserX/j3a" target="_blank"><i class="fa fa-github"></i></a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col s12 xl10 offset-xl1">
						<div class="content">
							<div class="row" style="margin-top: 20px;">
								<form id="login-cert-form" class="col s6 offset-s3" action="">
									<div class="row" id="login-failed">
										<div class="col s12">
											<p>Login failed!</p>
										</div>
									</div>
									<div class="row" style="margin-bottom: 0px;">
										<div class="input-field col s12">
											<input id="username" type="text" class="validate">
											<label for="username">Username</label>
										</div>
									</div>
									<div class="row">
										<div class="col s12 file-field input-field">
											<div class="btn">
												<span>File</span>
												<input id="certificate" type="file">
										  	</div>
											<div class="file-path-wrapper">
												<input class="file-path validate" type="text">
										  	</div>
										</div>
									</div>
									<div class="row">
										<div class="col s12">
											<button id="login-cert-button" type="submit" class="contentButton"><span>Login</span></button>
										</div>
									</div>
								</form>
							</div>	
						</div>
					</div>
				</div>
			</div>
		</main>
		
		<footer>
			<div class="container">
				<div class="row">
					<div class="col s12 xl10 offset-xl1">
						<div class="content">
							&copy; 2017 <a href="https://github.com/PraserX/" target="_blank">Praser</a>
						</div>
					</div>
				</div>
			</div>
		</footer>
		<!--
    <script src="http://localhost/nixs/js/j3a.js"></script>
    -->
    <!--
    <script src="https://praserx.github.io/j3a/demo/js/j3a.js"></script>
    -->
    <script type="text/javascript">
		//////////////////////////////////////////////////////////////////////////////////
        // J3A config, init and post processing
        //////////////////////////////////////////////////////////////////////////////////
		
		// locahost
        //var configUrl = "http://localhost/nixs/config.json";
		// production server
        var configUrl = "https://praserx.github.io/j3a/demo/config.json";
        
		// page prefix
        var prefix = "jtasite";
		
        j3a = new J3A();
        j3a.EnableDevMode();

        // Run initialization
        j3a.Init(configUrl, false, prefix).then(function () {
            $(document).ready(function () {
                // Run J3A page postprocessing
                j3a.RunPostProcessing().then(function (result) {  });
            });
        }).catch(function (error) {
            console.log(error);
        });
		
		
		//////////////////////////////////////////////////////////////////////////////////
        // Handle page dynamic changes (quick action!)
        //////////////////////////////////////////////////////////////////////////////////

        $(document).ready(function () {
            if (J3A.Logged(prefix) == true) {
                $("#link-login").hide();
                $("#link-logout").show();
            }
        });

        
        //////////////////////////////////////////////////////////////////////////////////
        // Certificate input loading --> Via new FileReader API (still under development)
        //////////////////////////////////////////////////////////////////////////////////
        var certificate = null;

        $(document).ready(function () {
            $('#certificate').on('change', function (e) {
                var file = e.target.files[0];
                if (!file) { return; }

                // New file reader instance
                var reader = new FileReader();

                // What to do if file is loaded
                reader.onload = function (e) {
                    var contents = e.target.result;
                    certificate = contents;
                };

                // Now read file
                reader.readAsText(file);
            });
        });

        //////////////////////////////////////////////////////////////////////////////////
        // Click events
        //////////////////////////////////////////////////////////////////////////////////

        // Login button
        $("#login-form").on("submit", function (e) {
            e.preventDefault();
            j3a.Login($("#username").val(), $("#password").val()).then(function (result) {
                window.location.href = j3a.GetBaseUrl(); // Now redirect to main page!
            }, function (err) {
                console.log(err);
                $("#login-failed").show();
            });
        });

        // Login Certificate button
        $("#login-cert-form").on("submit", function (e) {
            e.preventDefault();
            j3a.LoginByPrivateKey($("#username").val(), certificate).then(function (result) {
                window.location.href = j3a.GetBaseUrl(); // Now redirect to main page!
            }, function (err) {
                console.log(err);
                $("#login-failed").show();
            });
        });

        // Logout button
        $("#link-logout").click(function () {
            j3a.PartialLogout();
            window.location.href = j3a.GetBaseUrl();
        });
    </script>
</body>
</html>
